# Микросервис веб-интерфейса для RAG системы

Этот микросервис предоставляет веб-интерфейс для мониторинга и управления основным сервисом обработки файлов.

## Функциональность

1. **Мониторинг состояния** - отображение статуса основного сервиса
2. **Просмотр файлов** - список файлов с их статусами
3. **Управление процессом** - запуск/остановка обработки файлов
4. **Управление файлами** - повторная обработка, удаление файлов
5. **Кэширование данных** - уменьшение количества запросов к основному сервису
6. **Базовая аутентификация** - защита веб-интерфейса с помощью Basic Auth

## Архитектура

Микросервис веб-интерфейса взаимодействует с основным сервисом через HTTP API, обеспечивая разделение ответственностей.
Веб-интерфейс использует шаблоны Jinja2 для генерации HTML-страниц и включает в себя механизм кэширования GET-запросов
для повышения производительности.

## Запуск

Для запуска микросервиса:

1. Убедитесь, что запущен основный сервис (обычно на http://localhost:5001)
2. Установите зависимости:
```bash
pip install -r requirements.txt
```
3. Запустите веб-интерфейс:
```bash
python web_ui_service.py
```

По умолчанию веб-интерфейс доступен по адресу http://localhost:5000

## Конфигурация

Микросервис поддерживает конфигурацию через файл config.json и переменные окружения:

### config.json
```json
{
  "server": {
    "host": "0.0.0.0",
    "port": 8000,
    "debug": false
  },
  "services": {
    "converter_host": "localhost",
    "converter_port": 50051,
    "chunker_host": "localhost",
    "chunker_port": 50052,
    "embedder_host": "localhost",
    "embedder_port": 50053,
    "indexer_host": "localhost",
    "indexer_port": 50054,
    "searcher_host": "localhost",
    "searcher_port": 50055,
    "websearch_host": "localhost",
    "websearch_port": 8001
  },
  "logging": {
    "level": "INFO",
    "file": "web_ui.log",
    "format": "%(asctime)s [%(levelname)s] %(name)s: %(message)s"
  }
}
```

### .env файл
```
WEB_UI_USERNAME=admin
WEB_UI_PASSWORD=change-me
WEB_UI_REQUIRE_AUTH=1
MAIN_SERVICE_URL=http://localhost:5001
```

## Переменные окружения

| Переменная | Описание | По умолчанию |
|------------|----------|--------------|
| WEB_UI_USERNAME | Имя пользователя для аутентификации | "" |
| WEB_UI_PASSWORD | Пароль для аутентификации | "" |
| WEB_UI_REQUIRE_AUTH | Включить аутентификацию (1/0) | 1 |
| MAIN_SERVICE_URL | URL основного сервиса | http://localhost:5001 |

## API

Веб-интерфейс делегирует все действия основному сервису через его API:
- `/api/stats` - статистика по файлам
- `/api/files` - список файлов
- `/api/control/start` - запуск обработки
- `/api/control/stop` - остановка обработки
- `/api/file/{id}/retry` - повторная обработка файла
- `/api/file/{id}` - удаление файла
- `/api/manual_scan` - ручное сканирование

## Механизм кэширования

Микросервис включает в себя механизм кэширования GET-запросов для уменьшения нагрузки на основной сервис.
Кэшированные данные хранятся в памяти и имеют срок жизни 5 секунд. Кэширование применяется только к GET-запросам
и учитывает параметры запроса при формировании ключа кэша.

## Безопасность

Микросервис поддерживает базовую аутентификацию по протоколу HTTP Basic Authentication.
Для включения аутентификации установите переменную окружения `WEB_UI_REQUIRE_AUTH=1` и укажите
учетные данные в `WEB_UI_USERNAME` и `WEB_UI_PASSWORD`.

## Интеграция с WebConfig

Микросервис может управляться через WebConfig - централизованный веб-интерфейс для управления конфигурациями всех микросервисов в системе RAG. После создания файлов config.json и .env, веб-интерфейс становится доступным для:
- Просмотра и редактирования конфигурации через веб-интерфейс
- Управления запуском/остановкой/перезапуском сервиса
- Просмотра логов сервиса

## Структура проекта

```
web_ui/
├── web_ui_service.py         # Основной файл сервиса
├── config.json               # Файл конфигурации
├── .env                      # Файл переменных окружения
├── requirements.txt          # Зависимости
├── templates/                # HTML-шаблоны
│   ├── base.html             # Базовый шаблон
│   ├── index.html            # Главная страница
│   └── files.html            # Страница файлов
└── static/                   # Статические файлы (CSS, JS)
```

## Зависимости

- Flask - веб-фреймворк
- Requests - HTTP-клиент для взаимодействия с основным сервисом
- python-dotenv - загрузка переменных окружения
- flask-cors - поддержка CORS